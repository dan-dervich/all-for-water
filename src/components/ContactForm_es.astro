<section
  class="bg-contact-color-bg text-zinc-700 flex justify-center items-center flex-col w-full pt-[128px]"
>
  <h2
    class="flex justify-center p-10 text-3xl items-center text-center text-light-blue"
  >
    Ponte en contacto con nosotros
  </h2>
  <form id="contactForm_es" class="justify-center items-center w-full sm:w-3/4">
    <div class="flex w-full flex-col gap-y-5 px-10">
      <div
        class="flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row justify-between gap-x-10"
      >
        <div class="flex flex-col w-full">
          <label for="nombre_es">Nombre:</label>
          <input
            type="text"
            id="nombre_es"
            name="nombre_es"
            placeholder="Tu nombre..."
            class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
          />
        </div>
        <div class="flex flex-col w-full">
          <label for="email_es">Correo electrónico:</label>
          <input
            type="text"
            id="email_es"
            name="email_es"
            placeholder="Tu correo electrónico..."
            class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
          />
        </div>
        <div class="flex flex-col w-full">
          <label for="number_es">Número de teléfono:</label>
          <input
            type="tel"
            id="number_es"
            name="number_es"
            placeholder="Tu número de teléfono..."
            class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
          />
        </div>
      </div>
      <div class="flex flex-col justify-center items-center">
        <label class="self-start" for="mensaje_es">Mensaje:</label>
        <textarea
          id="mensaje_es"
          name="mensaje_es"
          placeholder="Tu mensaje..."
          class="bg-transparent p-2 border-b-[2px] border-slate-400 focus:outline-none focus:border-black transition-colors w-full"
        ></textarea>
        <button
          type="submit"
          class="bg-light-blue text-white flex justify-center items-center p-2 rounded-md hover:opacity-90 transition-opacity my-5 w-40"
        >
          Enviar
        </button>
      </div>
    </div>
  </form>
</section>

<script>
  import Toastify from "toastify-js";
  document
    .getElementById("contactForm_es")
    .addEventListener("submit", async function (event) {
      event.preventDefault();

      const nombre = (document.getElementById("nombre_es") as HTMLInputElement)
        .value;
      const mensaje = (
        document.getElementById("mensaje_es") as HTMLTextAreaElement
      ).value;
      const email = (document.getElementById("email_es") as HTMLInputElement)
        .value;
      const tel = (document.getElementById("number_es") as HTMLInputElement)
        .value;

      const data = {
        nombre: nombre,
        mensaje: mensaje,
        email: email,
        tel: tel,
      };

      // Mostrar toast de carga
      const loadingToast = Toastify({
        text: "Enviando mensaje...",
        duration: -1,
        close: true,
        gravity: "top",
        position: "right",
        backgroundColor: "#3498db",
      }).showToast();

      try {
        const response = await fetch(
          "https://contact-app-murex.vercel.app/afw/send-mail",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          }
        );

        // Cerrar el toast de carga
        loadingToast.hideToast();

        if (response.ok) {
          // Mostrar toast de éxito
          Toastify({
            text: "Mensaje enviado exitosamente.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#28a745",
          }).showToast();

          // Vaciar los campos del formulario
          (
            document.getElementById("contactForm_es") as HTMLFormElement
          ).reset();
        } else {
          // Mostrar toast de error
          Toastify({
            text: "Hubo un error al enviar el mensaje.",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#dc3545",
          }).showToast();
        }
      } catch (error) {
        console.error("Error:", error);

        // Cerrar el toast de carga y mostrar toast de error
        loadingToast.hideToast();
        Toastify({
          text: "Hubo un problema con la solicitud.",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#dc3545",
        }).showToast();
      }
    });
</script>
